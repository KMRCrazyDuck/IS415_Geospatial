{
  "hash": "33ba1f6e7f0b88ffa2a65fdfb95a9a2e",
  "result": {
    "markdown": "---\ntitle: \"In-class Exercise 2: Geospatial Data Wrangling\"\nexecute:\n  warning: false\n  message: false\ndate: \"2023-01-16\"\nformat: html\neditor: visual\n---\n\n\n# **Setting the Scene**\n\nWater is an important resource to mankind. Clean and accessible water is critical to human health. It provides a healthy environment, a sustainable economy, reduces poverty and ensures peace and security. Yet over 40% of the global population does not have access to sufficient clean water. By 2025, 1.8 billion people will be living in countries or regions with absolute water scarcity, according to UN-Water. The lack of water poses a major threat to several sectors, including food security. Agriculture uses about 70% of the world's accessible freshwater.\n\nDeveloping countries are most affected by water shortages and poor water quality. Up to 80% of illnesses in the developing world are linked to inadequate water and sanitation. Despite technological advancement, providing clean water to the rural community is still a major development issues in many countries globally, especially countries in the Africa continent.\n\nTo address the issue of providing clean and sustainable water supply to the rural community, a global [Water Point Data Exchange (WPdx)](https://www.waterpointdata.org/about/) project has been initiated. The main aim of this initiative is to collect water point related data from rural areas at the water point or small water scheme level and share the data via WPdx Data Repository, a cloud-based data library. What is so special of this project is that data are collected based on [WPDx Data Standard](https://www.waterpointdata.org/wp-content/uploads/2021/04/WPDx_Data_Standard.pdf).\n\n# **Objectives**\n\nGeospatial analytics hold tremendous potential to address complex problems facing society. In this study, you are tasked to apply appropriate geospatial data wrangling methods to prepare the data for water point mapping study. For the purpose of this study, Nigeria will be used as the study country.\n\n## **The Data**\n\n### **Aspatial data**\n\nFor the purpose of this assignment, data from [WPdx Global Data Repositories](https://www.waterpointdata.org/access-data/) will be used. There are two versions of the data. They are: WPdx-Basic and WPdx+. You are required to use WPdx+ data set.\n\n### **Geospatial data**\n\nNigeria Level-2 Administrative Boundary (also known as Local Government Area) polygon features GIS data will be used in this take-home exercise. The data can be downloaded either from The [Humanitarian Data Exchange](https://data.humdata.org/) portal or [geoBoundaries](https://www.geoboundaries.org/).\n\n# **The Task**\n\nThe specific tasks of this take-home exercise are as follows:\n\n-   Using appropriate sf method, import the shapefile into R and save it in a simple feature data frame format. Note that there are three Projected Coordinate Systems of Nigeria, they are: EPSG: 26391, 26392, and 26303. You can use any one of them.\n\n-   Using appropriate tidyr and dplyr methods, derive the proportion of functional and non-functional water point at LGA level.\n\n-   Combining the geospatial and aspatial data frame into simple feature data frame.\n\n-   Visualising the distribution of water point by using appropriate analytical visualisation methods.\n\n## Importing a geospatial data in shapefile format\n\n::: {.cell}\n\n```{.r .cell-code}\npacman::p_load(sf, tidyverse, funModeling)\n```\n:::\n\n\n## Importing Geospatial\n\n::: {.cell}\n\n```{.r .cell-code}\ngeoBoundaries <- st_read(dsn = \"data/geospatial\", layer = \"geoBoundaries-NGA-ADM2\" ) %>% st_transform(crs = 26392)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nReading layer `geoBoundaries-NGA-ADM2' from data source \n  `C:\\Users\\kwekm\\Desktop\\SMU Year 3 Semester 2\\IS415 Geospatial Analytics and Applications\\KMRCrazyDuck\\IS415-KMR\\In-class_Ex\\In-class_Ex02\\data\\geospatial' \n  using driver `ESRI Shapefile'\nSimple feature collection with 774 features and 5 fields\nGeometry type: MULTIPOLYGON\nDimension:     XY\nBounding box:  xmin: 2.663851 ymin: 4.271484 xmax: 14.67735 ymax: 13.90103\nGeodetic CRS:  WGS 84\n```\n:::\n:::\n\n\n## Assigning EPSG code to a simple feature data frame\n\n::: {.cell}\n\n```{.r .cell-code}\nst_crs(geoBoundaries)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nCoordinate Reference System:\n  User input: EPSG:26392 \n  wkt:\nPROJCRS[\"Minna / Nigeria Mid Belt\",\n    BASEGEOGCRS[\"Minna\",\n        DATUM[\"Minna\",\n            ELLIPSOID[\"Clarke 1880 (RGS)\",6378249.145,293.465,\n                LENGTHUNIT[\"metre\",1]]],\n        PRIMEM[\"Greenwich\",0,\n            ANGLEUNIT[\"degree\",0.0174532925199433]],\n        ID[\"EPSG\",4263]],\n    CONVERSION[\"Nigeria Mid Belt\",\n        METHOD[\"Transverse Mercator\",\n            ID[\"EPSG\",9807]],\n        PARAMETER[\"Latitude of natural origin\",4,\n            ANGLEUNIT[\"degree\",0.0174532925199433],\n            ID[\"EPSG\",8801]],\n        PARAMETER[\"Longitude of natural origin\",8.5,\n            ANGLEUNIT[\"degree\",0.0174532925199433],\n            ID[\"EPSG\",8802]],\n        PARAMETER[\"Scale factor at natural origin\",0.99975,\n            SCALEUNIT[\"unity\",1],\n            ID[\"EPSG\",8805]],\n        PARAMETER[\"False easting\",670553.98,\n            LENGTHUNIT[\"metre\",1],\n            ID[\"EPSG\",8806]],\n        PARAMETER[\"False northing\",0,\n            LENGTHUNIT[\"metre\",1],\n            ID[\"EPSG\",8807]]],\n    CS[Cartesian,2],\n        AXIS[\"(E)\",east,\n            ORDER[1],\n            LENGTHUNIT[\"metre\",1]],\n        AXIS[\"(N)\",north,\n            ORDER[2],\n            LENGTHUNIT[\"metre\",1]],\n    USAGE[\n        SCOPE[\"Engineering survey, topographic mapping.\"],\n        AREA[\"Nigeria between 6°30'E and 10°30'E, onshore and offshore shelf.\"],\n        BBOX[3.57,6.5,13.53,10.51]],\n    ID[\"EPSG\",26392]]\n```\n:::\n\n```{.r .cell-code}\ngeoBoundaries26392 <- st_set_crs(geoBoundaries, 26392)\nst_crs(geoBoundaries26392)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nCoordinate Reference System:\n  User input: EPSG:26392 \n  wkt:\nPROJCRS[\"Minna / Nigeria Mid Belt\",\n    BASEGEOGCRS[\"Minna\",\n        DATUM[\"Minna\",\n            ELLIPSOID[\"Clarke 1880 (RGS)\",6378249.145,293.465,\n                LENGTHUNIT[\"metre\",1]]],\n        PRIMEM[\"Greenwich\",0,\n            ANGLEUNIT[\"degree\",0.0174532925199433]],\n        ID[\"EPSG\",4263]],\n    CONVERSION[\"Nigeria Mid Belt\",\n        METHOD[\"Transverse Mercator\",\n            ID[\"EPSG\",9807]],\n        PARAMETER[\"Latitude of natural origin\",4,\n            ANGLEUNIT[\"degree\",0.0174532925199433],\n            ID[\"EPSG\",8801]],\n        PARAMETER[\"Longitude of natural origin\",8.5,\n            ANGLEUNIT[\"degree\",0.0174532925199433],\n            ID[\"EPSG\",8802]],\n        PARAMETER[\"Scale factor at natural origin\",0.99975,\n            SCALEUNIT[\"unity\",1],\n            ID[\"EPSG\",8805]],\n        PARAMETER[\"False easting\",670553.98,\n            LENGTHUNIT[\"metre\",1],\n            ID[\"EPSG\",8806]],\n        PARAMETER[\"False northing\",0,\n            LENGTHUNIT[\"metre\",1],\n            ID[\"EPSG\",8807]]],\n    CS[Cartesian,2],\n        AXIS[\"(E)\",east,\n            ORDER[1],\n            LENGTHUNIT[\"metre\",1]],\n        AXIS[\"(N)\",north,\n            ORDER[2],\n            LENGTHUNIT[\"metre\",1]],\n    USAGE[\n        SCOPE[\"Engineering survey, topographic mapping.\"],\n        AREA[\"Nigeria between 6°30'E and 10°30'E, onshore and offshore shelf.\"],\n        BBOX[3.57,6.5,13.53,10.51]],\n    ID[\"EPSG\",26392]]\n```\n:::\n:::\n\n\n## Importing the aspatial data\n\n::: {.cell}\n\n```{.r .cell-code}\nlistings <- read_csv(\"data/aspatial/Water_Point_Data_Exchange_-_Plus__WPdx__.csv\")\nlist(listings)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[[1]]\n# A tibble: 406,566 × 70\n   row_id `#source`     #lat_d…¹ #lon_…² #repo…³ #stat…⁴ #wate…⁵ #wate…⁶ #wate…⁷\n    <dbl> <chr>            <dbl>   <dbl> <chr>   <chr>   <chr>   <chr>   <chr>  \n 1 651816 Water For Pe… -1.57e+1   35.1  06/11/… Yes     <NA>    <NA>    Kiosk  \n 2 584864 Global Envir…  6.72e+0   -1.58 10/25/… Yes     <NA>    <NA>    Tapsta…\n 3 509399 GOAL           8.00e+0  -11.3  12/31/… Yes     <NA>    <NA>    Tapsta…\n 4  21983 WASH Liberia   8.08e+0  -10.1  12/04/… Yes     <NA>    <NA>    Tapsta…\n 5 660321 Water For Pe…  1.87e-1   30.4  03/14/… Yes     Piped … Piped … <NA>   \n 6 666619 Water For Pe… -4.23e-2   30.4  03/19/… Yes     Piped … Piped … <NA>   \n 7 657081 Water For Pe…  1.58e-3   30.3  03/05/… Yes     <NA>    <NA>    Tapsta…\n 8 669213 Water For Pe…  4.72e-2   30.4  09/07/… Yes     <NA>    <NA>    Tapsta…\n 9 668012 Water For Pe…  2.95e-1   30.7  03/02/… Yes     <NA>    <NA>    Tapsta…\n10 672047 Water For Pe…  2.85e-1   30.6  03/20/… Yes     Piped … Piped … <NA>   \n# … with 406,556 more rows, 61 more variables: `#water_tech_category` <chr>,\n#   `#facility_type` <chr>, `#clean_country_name` <chr>, `#clean_adm1` <chr>,\n#   `#clean_adm2` <chr>, `#clean_adm3` <chr>, `#clean_adm4` <chr>,\n#   `#install_year` <dbl>, `#installer` <chr>, `#rehab_year` <lgl>,\n#   `#rehabilitator` <lgl>, `#management_clean` <chr>, `#status_clean` <chr>,\n#   `#pay` <chr>, `#fecal_coliform_presence` <chr>,\n#   `#fecal_coliform_value` <dbl>, `#subjective_quality` <chr>, …\n```\n:::\n:::\n\n\n## Creating a simple feature data frame from an aspatial data frame\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlistings_sf <- st_as_sf(listings,\n                        coords = c(\"#lon_deg\", \"#lat_deg\"),\n                        crs = 4326) %>%\n  st_transform(crs = 26392)\nglimpse(listings_sf)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nRows: 406,566\nColumns: 69\n$ row_id                        <dbl> 651816, 584864, 509399, 21983, 660321, 6…\n$ `#source`                     <chr> \"Water For People\", \"Global Environment …\n$ `#report_date`                <chr> \"06/11/2018 12:00:00 AM\", \"10/25/2017 12…\n$ `#status_id`                  <chr> \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\"…\n$ `#water_source_clean`         <chr> NA, NA, NA, NA, \"Piped Water\", \"Piped Wa…\n$ `#water_source_category`      <chr> NA, NA, NA, NA, \"Piped Water\", \"Piped Wa…\n$ `#water_tech_clean`           <chr> \"Kiosk\", \"Tapstand\", \"Tapstand\", \"Tapsta…\n$ `#water_tech_category`        <chr> \"Tapstand\", \"Tapstand\", \"Tapstand\", \"Tap…\n$ `#facility_type`              <chr> \"Improved\", \"Improved\", \"Improved\", \"Imp…\n$ `#clean_country_name`         <chr> \"Malawi\", \"Ghana\", \"Sierra Leone\", \"Libe…\n$ `#clean_adm1`                 <chr> \"Blantyre\", \"Ashanti\", \"Eastern\", \"Lofa\"…\n$ `#clean_adm2`                 <chr> \"Blantyre City\", \"Asokore Mampong Munici…\n$ `#clean_adm3`                 <chr> \"n.a. (2465)\", NA, \"Kando Leppeama\", \"Lu…\n$ `#clean_adm4`                 <chr> NA, NA, NA, NA, \"Kamwenge Town Council\",…\n$ `#install_year`               <dbl> NA, 2017, NA, NA, NA, NA, NA, NA, NA, NA…\n$ `#installer`                  <chr> NA, NA, \"Water Aid\", NA, NA, NA, NA, NA,…\n$ `#rehab_year`                 <lgl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …\n$ `#rehabilitator`              <lgl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …\n$ `#management_clean`           <chr> NA, NA, NA, \"School Management\", NA, NA,…\n$ `#status_clean`               <chr> NA, NA, \"Functional\", NA, NA, NA, NA, NA…\n$ `#pay`                        <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …\n$ `#fecal_coliform_presence`    <chr> NA, NA, NA, NA, \"Present\", \"Present\", \"P…\n$ `#fecal_coliform_value`       <dbl> NA, 0, NA, NA, NA, NA, NA, NA, NA, NA, N…\n$ `#subjective_quality`         <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …\n$ `#activity_id`                <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …\n$ `#scheme_id`                  <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …\n$ `#wpdx_id`                    <chr> \"5GPQ73F2+C77\", \"6CRWPCF9+69X\", \"6CWC2P2…\n$ `#notes`                      <chr> NA, NA, \"Poor…Jenneh…Kandu Leppiema……\", …\n$ `#orig_lnk`                   <chr> NA, NA, NA, \"https://wash-liberia.org/ra…\n$ `#photo_lnk`                  <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …\n$ `#country_id`                 <chr> \"MW\", \"GH\", \"SL\", \"LR\", \"UG\", \"UG\", \"UG\"…\n$ `#data_lnk`                   <chr> \"https://catalog.waterpointdata.org/data…\n$ `#distance_to_primary_road`   <dbl> 7034.8250, 3677.9101, 17540.3622, 21602.…\n$ `#distance_to_secondary_road` <dbl> 3431.81039, 3944.70081, 4052.93329, 3703…\n$ `#distance_to_tertiary_road`  <dbl> 421.90674, 690.13048, 104.43156, 14456.7…\n$ `#distance_to_city`           <dbl> 8321.854, 5362.011, 17003.136, 52727.389…\n$ `#distance_to_town`           <dbl> 22044.5149, 7550.3392, 15474.4428, 31606…\n$ water_point_history           <chr> \"{\\\"2018-06-11\\\": {\\\"source\\\": \\\"Water F…\n$ rehab_priority                <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …\n$ water_point_population        <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …\n$ local_population_1km          <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …\n$ crucialness_score             <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …\n$ pressure_score                <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …\n$ usage_capacity                <dbl> 250, 250, 250, 250, 250, 250, 250, 250, …\n$ is_urban                      <lgl> TRUE, TRUE, FALSE, FALSE, FALSE, FALSE, …\n$ days_since_report             <dbl> 1562, 1791, 4281, 2482, 1286, 1281, 1660…\n$ staleness_score               <dbl> 61.11805, 56.86178, 25.93887, 45.73258, …\n$ latest_record                 <lgl> TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE…\n$ location_id                   <dbl> 355848, 349148, 98255, 285679, 362508, 3…\n$ cluster_size                  <dbl> 1, 1, 1, 1, 1, 1, 1, 2, 1, 1, 1, 1, 1, 1…\n$ `#clean_country_id`           <chr> \"MWI\", \"GHA\", \"SLE\", \"LBR\", \"UGA\", \"UGA\"…\n$ `#country_name`               <chr> \"Malawi\", \"Ghana\", \"Sierra Leone\", \"Libe…\n$ `#water_source`               <chr> NA, NA, \"Gravity stand-post\", \"Public st…\n$ `#water_tech`                 <chr> \"Communal water kiosk\", \"Standpost\", NA,…\n$ `#status`                     <chr> \"1\", NA, \"Functional\", NA, \"1\", \"0\", \"1\"…\n$ `#adm2`                       <chr> \"Kameza\", NA, \"Kenema\", NA, \"Kibale\", \"K…\n$ `#adm3`                       <chr> NA, NA, NA, NA, \"Kamwenge T/Council\", \"B…\n$ `#management`                 <chr> NA, NA, NA, \"Institutional Management - …\n$ `#adm1`                       <chr> \"Blantyre\", NA, \"Eastern\", \"Lofa\", \"Kamw…\n$ `New Georeferenced Column`    <chr> \"POINT (35.0506729 -15.7264642)\", \"POINT…\n$ lat_deg_original              <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …\n$ lat_lon_deg                   <chr> \"(-15.7264642°, 35.0506729°)\", \"(6.72312…\n$ lon_deg_original              <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …\n$ public_data_source            <chr> \"https://catalog.waterpointdata.org/data…\n$ converted                     <chr> NA, NA, \"#install_year, #notes\", \"#statu…\n$ count                         <dbl> 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1…\n$ created_timestamp             <chr> \"02/18/2022 05:36:33 AM\", \"07/29/2020 07…\n$ updated_timestamp             <chr> \"02/18/2022 05:36:33 AM\", \"07/29/2020 07…\n$ geometry                      <POINT [m]> POINT (3606543 -2375877), POINT (-…\n```\n:::\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}